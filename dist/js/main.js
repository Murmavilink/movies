(()=>{"use strict";const e=async e=>{const a=await fetch(e,{method:"GET",headers:{"X-API-KEY":"aa9207e0-e928-4988-878f-a6ef9e404c47","Content-Type":"application/json"}});return await a.json()};(()=>{const a="https://kinopoiskapiunofficial.tech/api/v2.2/films/top?type=TOP_100_POPULAR_FILMS&page=1",i=document.querySelector("form"),s=document.querySelector(".header__search"),n=document.querySelector(".movies"),o=document.querySelector(".modal");i.addEventListener("submit",(i=>{i.preventDefault(),s.value?e("https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword?keyword="+s.value).then((e=>{t(e)})):e(a).then((e=>{t(e)})),s.value=""}));const t=e=>{n.innerHTML="",e.films.forEach((e=>{const a=document.createElement("div");a.classList.add("movie"),a.style.cursor="pointer",a.insertAdjacentHTML("beforeend",`\n            <div class="movie__cover-inner">\n                <img src="${e.posterUrlPreview}" class="movie__cover"\n                    alt="${e.nameRu}">\n                <div class="movie__cover--darkened"></div>\n                </div>\n                <div class="movie__info">\n                <h3 class="movie__title">${e.nameRu}</h3>\n                <div class="movie__id">${e.filmId}</div>\n                <div class="movie__category">\n                ${e.genres.map((e=>e.genre)).join(", ")}\n                </div>\n                ${+e.rating?`<div class="movie__average movie__average--${l(e.rating)}">${e.rating}</div>`:""}\n            </div>`),n.append(a)}))},l=e=>e>=7?"green":e>5?"orange":"red";e(a).then((e=>{t(e)})),n.addEventListener("click",(a=>{a.target.closest(".movie")&&(async({id:a,movieDetails:i,modal:s})=>{const n={};let o,t;await e(i+a).then((e=>{o=e})),await e(i+a+"/videos").then((e=>{t=e})),t.items.forEach(((e,a)=>{e&&a<1&&(n.name=e.name,n.url=e.url)})),document.body.classList.add("stop-scrolling"),s.classList.add("modal--show"),s.innerHTML="",s.insertAdjacentHTML("beforeend",`\n            <div class="modal__card">\n                <img class="modal__movie-backdrop" src="${o.posterUrlPreview}" alt="">\n                <h2>\n                    <span class="modal__movie-title">${o.nameRu}</span>\n                    <span class="modal__movie-release-year">${o.year}</span>\n                </h2>\n                <ul class="modal__movie-info">\n                    <div class="loader"></div>\n                    <li class="modal__movie-genre">Жанр - ${o.genres.map((e=>e.genre)).join(", ")}</li>\n                    ${o.filmLength?`<li class="modal__movie-runtime">Время - ${o.filmLength} минут</li>`:""}\n                    <li >Сайт: <a class="modal__movie-site" href="${o.webUrl}">${o.webUrl}</a></li>\n                    <li class="modal__movie-overview">Описание - ${o.description}</li>\n                    ${Object.keys(n).length?`<li>${n.name} <a class="modal__movie-site" target="_blank" href="${n.url}">${n.url}</a></li>`:""}\n                </ul>\n                <button type="button" class="modal__button-close">Закрыть</button>\n            </div>`),s.addEventListener("click",(e=>{!e.target.classList.contains("modal__button-close")&&e.target.closest(".modal__card")||(s.classList.remove("modal--show"),document.body.classList.remove("stop-scrolling"))})),window.addEventListener("keydown",(e=>{"Escape"===e.key&&s.classList.remove("modal--show")}))})({id:a.target.closest(".movie").querySelector(".movie__id").textContent,movieDetails:"https://kinopoiskapiunofficial.tech/api/v2.2/films/",modal:o})}))})()})();