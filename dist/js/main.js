(()=>{"use strict";const e=async e=>{const i=await fetch(e,{method:"GET",headers:{"X-API-KEY":"aa9207e0-e928-4988-878f-a6ef9e404c47","Content-Type":"application/json"}});return await i.json()};(()=>{const i="https://kinopoiskapiunofficial.tech/api/v2.2/films/top?type=TOP_100_POPULAR_FILMS&page=1",a=document.querySelector("form"),s=document.querySelector(".form__search"),n=document.querySelector(".movies"),t=document.querySelector(".modal");a.addEventListener("submit",(a=>{a.preventDefault(),s.value?e("https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword?keyword="+s.value).then((e=>{o(e)})):e(i).then((e=>{o(e)})),s.value=""}));const o=e=>{n.innerHTML="",e.films.forEach((e=>{const i=document.createElement("div");i.classList.add("movie"),i.style.cursor="pointer",i.insertAdjacentHTML("beforeend",`\n            <div class="movie__cover-inner">\n                <img src="${e.posterUrlPreview}" class="movie__cover"\n                    alt="${e.nameRu}">\n                <div class="movie__cover--darkened"></div>\n                </div>\n                <div class="movie__info">\n                <h3 class="movie__title">${e.nameRu}</h3>\n                <div class="movie__id">${e.filmId}</div>\n                <div class="movie__category">\n                ${e.genres.map((e=>e.genre)).join(", ")}\n                </div>\n                ${+e.rating?`<div class="movie__average movie__average--${l(e.rating)}">${e.rating}</div>`:""}\n            </div>`),n.append(i)}))},l=e=>e>=7?"green":e>5?"orange":"red";e(i).then((e=>{o(e)})),n.addEventListener("click",(i=>{i.target.closest(".movie")&&(async({id:i,movieDetails:a,modal:s})=>{const n={};let t,o;await e(a+i).then((e=>{t=e})),await e(a+i+"/videos").then((e=>{o=e})),o.items.forEach(((e,i)=>{e&&i<1&&(n.name=e.name,n.url=e.url)}));const l=(e,i)=>screen.width<=620&&e.trim().length>i?e.substring(0,i).trim()+"...":e;document.body.classList.add("stop-scrolling"),s.classList.add("modal--show"),s.innerHTML="",s.insertAdjacentHTML("beforeend",`\n            <div class="modal__card">\n                <img class="modal__movie-backdrop" src="${t.posterUrlPreview}" alt="">\n                <h2>\n                    <span class="modal__movie-title">${t.nameRu}</span>\n                    <span class="modal__movie-release-year">${t.year}</span>\n                </h2>\n                <ul class="modal__movie-info">\n                    <div class="loader"></div>\n                    <li class="modal__movie-genre">Жанр - ${t.genres.map((e=>e.genre)).join(", ")}</li>\n                    ${t.filmLength?`<li class="modal__movie-runtime">Время - ${t.filmLength} минут</li>`:""}\n                    <li >Сайт: <a class="modal__movie-site" href="${t.webUrl}">${l(t.webUrl,20)}</a></li>\n                    <li class="modal__movie-overview">Описание - ${l(t.description,200)}</li>\n                    ${Object.keys(n).length?`<li>${n.name} <a class="modal__movie-site" target="_blank" href="${n.url}">${l(n.url,20)}</a></li>`:""}\n                </ul>\n                <button type="button" class="modal__button-close">Закрыть</button>\n            </div>`),s.addEventListener("click",(e=>{!e.target.classList.contains("modal__button-close")&&e.target.closest(".modal__card")||(s.classList.remove("modal--show"),document.body.classList.remove("stop-scrolling"))})),window.addEventListener("keydown",(e=>{"Escape"===e.key&&s.classList.remove("modal--show")}))})({id:i.target.closest(".movie").querySelector(".movie__id").textContent,movieDetails:"https://kinopoiskapiunofficial.tech/api/v2.2/films/",modal:t})}))})()})();